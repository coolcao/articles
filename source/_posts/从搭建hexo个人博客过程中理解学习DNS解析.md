---
title: 从搭建hexo个人博客过程中理解学习DNS解析
date: 2016-10-19 00:42:21
tags: [DNS解析,计算机网络]
categories: 技术博客
---

最近，新接触到了hexo这个博客工具，并利用它搭建了基于git hub pages静态页面的个人博客站，绑定了自己的域名，在绑定域名这个环节，逐步学习并理解了域名解析这个过程，想到之前有个有趣的面试题就是“当你在浏览器地址栏中输入一个网址，并按下回车键后，发生了什么”，于是就想把此记录下。

<!-- more -->

## DNS域名称类型
|名称类型|说明|示例|
|----|----|----|
|根域(Root domain)|这是表示未命名的等级; 目录树的顶部它有时显示为两个空引号 ("")，表示空值。 DNS 域名中使用时，它规定由尾部句点 (.) 来指定名称位于根或更高级别的域层次结构。 在此情况下，DNS 域名被认为是完整和点到准确的位置在树中的名称。|单个句点 (.) 或句点用于末尾的名称，如"example.microsoft.com"|
|顶级域(Top-level domain)|用来指示某个国家/地区或组织使用的名称的类型名称。|"".com"，表示一个名称注册为在 Internet 上的商业使用的业务。|
|二级域(Second-level domain)|可变长度的个体或组织，以便在 Internet 上使用的注册名称。 这些名称始终基于相应的顶级域，具体取决于组织或地理位置名称使用的位置的类型。|""microsoft.com。 "，这是由 Internet DNS 域的名称注册向 Microsoft 注册的二级域名称。|
|子域(Subdomain)|其他名称的组织可以创建从已注册的二级域名派生的。 这些功能包括添加到组织中的名称的 DNS 树的增长，并将其分为部门或地理位置的名称。|"example.microsoft.com"。 "，这是由 Microsoft 指定文档名称示例中用于虚构子域。|
|主机或资源名称(Host or resource name)|代表名称的 DNS 树的叶节点并标识特定的资源的名称。 通常情况下，DNS 域名的最左侧的标签标识网络上的特定计算机。 例如，如果主机 (A) 资源记录中使用此级别的名称，则它用于查找基于其主机名的计算机的 IP 地址。|""主机-a.example.microsoft.com。"，其中第一个标签 （"主机-a"） 是网络上的特定计算机的 DNS 主机名。|


## 域名解析
### 域名解析过程
* **浏览器缓存**：浏览器会首先检查缓存中有没有该域名的缓存记录，如果有，解析过程结束，如果没有，继续下一步。浏览器会缓存DNS记录一段时间，时间，大小等通过TTL设置。
* **系统缓存**：在浏览器缓存里没有找到记录，浏览器会做一个系统调用，查找系统缓存里是否有DNS记录。Windows系统中可以通过`C:\Windows\System32\drivers\etc\hosts`文件来设置，linux上配置文件是`/etc/named.conf`。
* **路由器缓存**：如果本地系统缓存也未找到，前面的查询请求发向路由器，路由器也会有自己的DNS缓存记录。
* **ISP DNS缓存**：接下来要检查的就是网络服务提供商缓存DNS的服务器，在这一般都能找到相应的缓存记录。ISP专门的域名解析服务器（LDNS）一般都会缓存域名解析记录，缓存时间受域名的失效时间控制，大约80%的域名解析到这里就已经完成了，所以，LDNS主要承担了域名的解析工作。
* **递归搜索**：从根域名服务器开始进行递归搜索，到顶级域名服务器，再到第二层域服务器。

![DNS递归查找](http://7xt3oh.com2.z0.glb.clouddn.com/blog/500pxAn_example_of_theoretical_DNS_recursion_svg.png)

### 域名解析示意图
![域名解析](http://7xt3oh.com2.z0.glb.clouddn.com/blog/32648197_1.jpg)

前面浏览器缓存，系统缓存及路由器缓存都是在本地完成的，所以，图中所示是从本地区的域名服务器LDNS开始的。
我们在网络配置中，都会有一个“DNS服务器地址”这一项，这个地址就是本地区域名服务器LDNS。这个DNS服务器通常是由提供给你网络服务的提供商提供，如联通或电信等。
如图中第三步，用户发起请求向LDNS查询，LDNS会查询其服务器上的缓存记录，如果有，返回，没有，继续。
如果LDNS没有查找到缓存记录，就直接到Root Server域名服务器请求解析。
根域名服务器返回给本地域名服务器一个所查询的主域名服务器(gTLD Server)地址，gTLD是国际顶级域名服务器，如.com,.cn,.org等，全球只有13台根域名服务器。
LDNS再向上一步返回的gTLD服务器发送请求。gTLD服务器查找并返回此域名对应的Name Server域名服务器的地址。
Name Server域名服务器会查询存储的域名和IP映射关系表，将ip连同一个TTL值返回给LDNS域名服务器
LDNS域名服务器会缓存这个域名和ip的对应关系，并将结果返回给用户。
用户本地根据TTL值缓存在本地系统中。
在实际DNS解析过程中，Name Server也可能有很多级，或者有一个GTM负载均衡控制，这都有可能会影响到域名解析过程。


![域名解析示意图](http://7xt3oh.com2.z0.glb.clouddn.com/blog/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90.jpg)
解析 www.163.com示例

## hexo绑定域名过程
### 阿里云DNS解析
由于，我的域名是在万网买的，直接使用的万网的域名解析。
我的域名 `coolcao.com`的相关信息：
![域名信息](http://7xt3oh.com2.z0.glb.clouddn.com/blog/coolcao_dns_server.png)

在万网的域名解析里面添加如下一条记录
![域名解析](http://7xt3oh.com2.z0.glb.clouddn.com/blog/coolcao_dns.png)
这里有记录值及TTL值等，请注意，这里的记录值是我在github上的静态页面地址，因此，当我访问我的域名 coolcao.com时，先由万网的 Name Server解析到github，然后由经github域名服务器再解析，至少有两层的Name Server进行解析。
